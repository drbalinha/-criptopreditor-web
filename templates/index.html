<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Preditor de Criptomoedas (MAX Power)</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; line-height: 1.6; color: #333; max-width: 800px; margin: 20px auto; padding: 0 15px; background-color: #f4f4f9; }
        h1 { color: #2c3e50; text-align: center; }
        #controls { text-align: center; margin-bottom: 20px; }
        button { background-color: #3498db; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 16px; transition: background-color 0.3s; }
        button:hover { background-color: #2980b9; }
        button:disabled { background-color: #95a5a6; cursor: not-allowed; }
        #results { border-top: 2px solid #ddd; padding-top: 20px; }
        .result-card { background-color: white; border: 1px solid #ecf0f1; border-radius: 8px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .result-card h2 { margin-top: 0; color: #34495a; }
        .price-info { font-size: 1.1em; margin-bottom: 10px; }
        .direction-up { color: #2ecc71; font-weight: bold; }
        .direction-down { color: #e74c3c; font-weight: bold; }
        .confidence-bar { background-color: #ecf0f1; border-radius: 5px; height: 8px; margin-top: 5px; overflow: hidden; }
        .confidence-fill { background-color: #3498db; height: 100%; }
        #status { text-align: center; font-style: italic; color: #7f8c8d; }
    </style>
</head>
<body>
    <h1>Preditor de Criptomoedas (MAX Power)</h1>
    <div id="controls">
        <button id="predictBtn">Analisar Top 20 Moedas</button>
    </div>
    <div id="status">Clique para iniciar a análise mais poderosa...</div>
    <div id="results"></div>

    <script>
        const predictBtn = document.getElementById('predictBtn');
        const resultsDiv = document.getElementById('results');
        const statusDiv = document.getElementById('status');
        const TOP_COINS = ["BTC/USDT", "ETH/USDT", "XRP/USDT", "LTC/USDT", "BCH/USDT", "ADA/USDT", "DOGE/USDT", "DOT/USDT", "UNI/USDT", "LINK/USDT", "SOL/USDT", "MATIC/USDT", "ETC/USDT", "FIL/USDT", "AAVE/USDT", "MKR/USDT", "COMP/USDT", "SNX/USDT", "YFI/USDT", "AVAX/USDT"];

        predictBtn.addEventListener('click', async () => {
            predictBtn.disabled = true;
            resultsDiv.innerHTML = '';
            statusDiv.textContent = 'Analisando... Por favor, aguarde.';
            
            for (let i = 0; i < TOP_COINS.length; i++) {
                const coin = TOP_COINS[i];
                statusDiv.textContent = `Analisando ${i + 1}/${TOP_COINS.length}: ${coin}`;
                try {
                    const response = await fetch(`/predict/${coin}`);
                    if (!response.ok) throw new Error(`Erro HTTP ${response.status}`);
                    const data = await response.json();
                    displayResult(data);
                } catch (error) {
                    console.error('Falha no fetch para', coin, ':', error);
                    displayError(coin, error);
                }
            }
            predictBtn.disabled = false;
            statusDiv.textContent = 'Análise concluída.';
        });

        function displayResult(data) {
            if (data.error) {
                displayError(data.symbol || 'Desconhecido', data.error);
                return;
            }
            const card = document.createElement('div');
            card.className = 'result-card';
            const directionClass = data.prediction_direction === 'ALTA' ? 'direction-up' : 'direction-down';
            const arrow = directionClass === 'direction-up' ? '▲' : '▼';

            card.innerHTML = `
                <h2>${data.symbol}</h2>
                <div class="price-info">
                    <strong>Preço Atual:</strong> $${data.current_price.toFixed(2)}
                </div>
                <div class="price-info">
                    <strong>Preço Previsto:</strong> <span class="${directionClass}">$${(data.predicted_price || 0).toFixed(2)}</span>
                </div>
                <div class="price-info">
                    <strong>Direção:</strong> 
                    <span class="${directionClass}">${data.prediction_direction} ${arrow}</span>
                </div>
                <div>
                    <strong>Confiança:</strong> ${(data.prediction_confidence || 0).toFixed(2)}%
                    <div class="confidence-bar">
                        <div class="confidence-fill" style="width: ${data.prediction_confidence || 0}%"></div>
                    </div>
                </div>
            `;
            resultsDiv.appendChild(card);
        }

        function displayError(coin, error) {
            const card = document.createElement('div');
            card.className = 'result-card';
            card.innerHTML = `<h2>${coin}</h2><p class="direction-down">Falha ao buscar predição.</p>`;
            resultsDiv.appendChild(card);
        }
    </script>
</body>
</html>
