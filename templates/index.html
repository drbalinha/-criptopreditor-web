<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Preditor de Criptomoedas</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; line-height: 1.6; color: #333; max-width: 800px; margin: 20px auto; padding: 0 15px; background-color: #f4f4f9; }
        h1 { color: #2c3e50; text-align: center; }
        #controls { text-align: center; margin-bottom: 20px; }
        button { background-color: #3498db; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 16px; transition: background-color 0.3s; }
        button:hover { background-color: #2980b9; }
        button:disabled { background-color: #95a5a6; cursor: not-allowed; }
        #results { border-top: 2px solid #ddd; padding-top: 20px; }
        .result-card { background-color: white; border: 1px solid #ecf0f1; border-radius: 8px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .result-card h2 { margin-top: 0; color: #34495a; }
        .price { font-size: 1.1em; }
        .price-up { color: #2ecc71; }
        .price-down { color: #e74c3c; }
        #status { text-align: center; font-style: italic; color: #7f8c8d; }
    </style>
</head>
<body>

    <h1>Preditor de Criptomoedas</h1>

    <div id="controls">
        <button id="predictBtn">Analisar Top 20 Moedas</button>
    </div>

    <div id="status">Clique no botão para iniciar a análise...</div>
    <div id="results"></div>

    <script>
        const predictBtn = document.getElementById('predictBtn');
        const resultsDiv = document.getElementById('results');
        const statusDiv = document.getElementById('status');

        const TOP_COINS = [
            "BTC/USDT", "ETH/USDT", "XRP/USDT", "LTC/USDT", "BCH/USDT",
            "ADA/USDT", "DOGE/USDT", "DOT/USDT", "UNI/USDT", "LINK/USDT",
            "SOL/USDT", "MATIC/USDT", "ETC/USDT", "FIL/USDT", "AAVE/USDT",
            "MKR/USDT", "COMP/USDT", "SNX/USDT", "YFI/USDT", "AVAX/USDT"
        ];

        predictBtn.addEventListener('click', async () => {
            predictBtn.disabled = true;
            resultsDiv.innerHTML = '';
            statusDiv.textContent = 'Analisando... Por favor, aguarde.';

            for (let i = 0; i < TOP_COINS.length; i++) {
                const coin = TOP_COINS[i];
                statusDiv.textContent = `Analisando ${i + 1}/${TOP_COINS.length}: ${coin}`;
                
                try {
                    // AQUI ESTA A MAGICA: URL Relativa!
                    // Ele vai chamar "/predict/BTC/USDT" no mesmo servidor que serviu a pagina,
                    // ou seja, https://meu-preditor-cripto.onrender.com/predict/BTC/USDT
                    const response = await fetch(`/predict/${coin}`);

                    if (!response.ok) {
                        const errorText = await response.text();
                        throw new Error(`Erro HTTP ${response.status}: ${errorText}`);
                    }

                    const data = await response.json();
                    displayResult(data);

                } catch (error) {
                    console.error('Falha no fetch para', coin, ':', error);
                    displayError(coin, error);
                }
            }

            predictBtn.disabled = false;
            statusDiv.textContent = 'Análise concluída. Clique novamente para reanalisar.';
        });

        function displayResult(data) {
            const card = document.createElement('div');
            card.className = 'result-card';
            const direction = data.predicted_price >= data.current_price ? 'price-up' : 'price-down';
            const arrow = direction === 'price-up' ? '▲' : '▼';
            card.innerHTML = `
                <h2>${data.symbol}</h2>
                <p class="price">Preço Atual: $${data.current_price.toFixed(2)}</p>
                <p class="price ${direction}">
                    Previsão para o Próximo Período: <strong>$${data.predicted_price.toFixed(2)}</strong> ${arrow}
                </p>
            `;
            resultsDiv.appendChild(card);
        }

        function displayError(coin, error) {
            const card = document.createElement('div');
            card.className = 'result-card';
            card.innerHTML = `
                <h2>${coin}</h2>
                <p class="price-down">Falha ao buscar predição.</p>
                <p style="font-size: 0.8em; color: #7f8c8d;">${error.message}</p>
            `;
            resultsDiv.appendChild(card);
        }
    </script>

</body>
</html>
